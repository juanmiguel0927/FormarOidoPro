<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E.I.R. - Oído Funcional Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=JetBrains+Mono:wght@700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #020617; color: #f8fafc; }
        
        /* PIANO SCROLL AREA */
        .piano-viewport {
            width: 100%;
            overflow-x: auto;
            padding: 20px 20px 40px 20px;
            display: flex;
            justify-content: flex-start;
            background: #0f172a;
            border-top: 1px solid #1e293b;
            border-bottom: 1px solid #1e293b;
        }

        .piano-stage {
            position: relative;
            height: 240px;
            flex-shrink: 0;
            margin: 0 auto;
        }

        /* ESTILOS DE TECLA */
        .piano-key {
            position: absolute;
            top: 0;
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Etiquetas abajo */
            align-items: center;
            padding-bottom: 12px;
            transition: all 0.1s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .key-white {
            background: #f8fafc;
            border: 1px solid #94a3b8;
            height: 220px;
            width: 60px;
            z-index: 5;
        }
        .key-white:active { background: #e2e8f0; transform: translateY(2px); }

        .key-black {
            background: #020617;
            border: 1px solid #000;
            border-bottom: 10px solid #1e293b;
            height: 135px;
            width: 40px;
            z-index: 10;
        }
        .key-black:active { background: #1e293b; transform: translateY(2px); }

        /* LABELS EN LA PUNTA INFERIOR */
        .labels-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            pointer-events: none;
        }

        .degree-tag {
            width: 28px;
            height: 28px;
            background: #6366f1;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 13px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        .key-black .degree-tag {
            background: #f59e0b; 
            width: 24px;
            height: 24px;
            font-size: 11px;
        }

        .note-name {
            font-size: 10px;
            font-weight: 800;
            text-transform: none;
            opacity: 0.8;
            color: #1e293b;
            font-family: 'JetBrains Mono', monospace;
        }
        .key-black .note-name { color: #f8fafc; }

        /* INDICADORES */
        .tonic-marker {
            width: 6px;
            height: 6px;
            background: #6366f1;
            border-radius: 50%;
            margin-bottom: 4px;
            box-shadow: 0 0 8px #6366f1;
        }

        /* FEEDBACK */
        .correct { background: #10b981 !important; border-color: #059669 !important; z-index: 50 !important; }
        .correct .degree-tag { background: #059669 !important; border-color: white; }
        .correct .note-name { color: white !important; }

        .wrong { background: #ef4444 !important; border-color: #b91c1c !important; z-index: 50 !important; }
        .wrong .degree-tag { background: #be123c !important; }
        .wrong .note-name { color: white !important; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes bounce-in {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-bounce-in { animation: bounce-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- HEADER -->
    <header class="bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center shadow-xl z-50">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-xl">
                <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>
            </div>
            <h1 class="font-black text-xl tracking-tight">E.I.R. ROMERO <span class="text-indigo-400">PRO</span></h1>
        </div>

        <div class="flex items-center gap-4">
             <div class="flex bg-slate-800 rounded-lg p-1 border border-slate-700">
                <button onclick="setMode('melody')" id="mode-melody" class="px-3 py-1.5 rounded text-[10px] uppercase font-bold transition-all bg-indigo-600 text-white shadow">Melodía</button>
                <button onclick="setMode('harmony')" id="mode-harmony" class="px-3 py-1.5 rounded text-[10px] uppercase font-bold transition-all text-slate-400 hover:text-white">Armonía</button>
            </div>
            <div class="bg-slate-800 px-4 py-1.5 rounded-lg border border-slate-700 font-mono text-emerald-400 font-bold">
                <span id="score-val">0</span>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col relative overflow-hidden">
        
        <!-- Info & Controls -->
        <div class="p-6 flex justify-between items-start z-10">
            <div id="key-badge" class="bg-slate-800/90 backdrop-blur border border-slate-700 p-4 rounded-2xl shadow-2xl flex flex-col items-center min-w-[120px] hidden">
                <span class="text-[9px] uppercase tracking-widest text-slate-500 font-bold mb-1">Centro Tonal</span>
                <div class="flex items-baseline gap-2">
                    <span id="key-root" class="text-4xl font-black text-indigo-400">C</span>
                    <span id="key-quality" class="text-xs font-bold text-white bg-slate-700 px-2 py-0.5 rounded tracking-tighter uppercase">MAYOR</span>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button id="btn-init" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold px-8 py-4 rounded-2xl shadow-lg shadow-indigo-900/40 transition-all active:scale-95 flex items-center gap-3 text-lg">
                    <svg class="w-6 h-6 fill-white" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <span>Nueva Pregunta</span>
                </button>
                <button id="btn-repeat" class="hidden bg-slate-800 hover:bg-slate-700 text-slate-300 px-6 py-3 rounded-xl border border-slate-700 flex items-center justify-center gap-2 font-bold transition-all active:scale-95">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                    Repetir Sonido
                </button>
            </div>
        </div>

        <!-- Feedback UI -->
        <div id="feedback-ui" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 hidden text-center pointer-events-none">
            <div id="feedback-icon" class="text-7xl mb-4"></div>
            <h2 id="feedback-text" class="text-4xl font-black uppercase tracking-tighter italic"></h2>
        </div>

        <!-- PIANO SECTION -->
        <div id="piano-section-container" class="mt-auto relative z-30">
            <div id="imagina-overlay" class="absolute inset-0 bg-slate-900/95 backdrop-blur-md z-40 flex flex-col items-center justify-center hidden">
                <div class="w-20 h-20 bg-indigo-500/20 rounded-full flex items-center justify-center mb-4 animate-pulse border border-indigo-500/30">
                    <svg class="w-10 h-10 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <h3 class="text-xl font-bold uppercase tracking-widest text-indigo-300">Fase: Imagina</h3>
                <button onclick="revealPiano()" class="bg-slate-800 border border-slate-700 px-10 py-3 rounded-full font-bold hover:bg-slate-700 transition-colors mt-4 text-sm">Revelar Piano</button>
            </div>

            <div class="piano-viewport no-scrollbar">
                <div id="piano-stage" class="piano-stage">
                    <!-- Dinámico -->
                </div>
                <div id="harmony-grid" class="hidden w-full max-w-4xl mx-auto px-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 pb-12">
                    <!-- Armonía Dinámica -->
                </div>
            </div>

            <div class="bg-slate-900 p-4 text-center border-t border-slate-800">
                <button onclick="toggleImagina()" class="text-[10px] font-bold uppercase tracking-widest text-slate-500 hover:text-indigo-400 transition-colors flex items-center gap-2 mx-auto">
                    <span id="imagina-dot" class="w-2 h-2 rounded-full bg-slate-700"></span> Modo Imagina
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- DATA ---
        // Ortografía musical precisa basada en el intervalo funcional (0=1, 1=b2, 2=2, 3=b3, 4=3, 5=4, 6=#4, 7=5, 8=b6, 9=6, 10=b7, 11=7)
        const KEY_SPELLINGS = {
            // Sostenidos: G, D, A, E, B, F#
            'G':  ['G', 'Ab', 'A', 'Bb', 'B', 'C', 'C#', 'D', 'Eb', 'E', 'F', 'F#'],
            'D':  ['D', 'Eb', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B', 'C', 'C#'],
            'A':  ['A', 'Bb', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'],
            'E':  ['E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B', 'C', 'C#', 'D', 'D#'],
            'B':  ['B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#'],
            'F#': ['F#', 'G', 'G#', 'A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F'],
            
            // Bemoles: F, Bb, Eb, Ab, Db, Gb
            'F':  ['F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B', 'C', 'Db', 'D', 'Eb', 'E'],
            'Bb': ['Bb', 'Cb', 'C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A'],
            'Eb': ['Eb', 'Fb', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'Cb', 'C', 'Db', 'D'],
            'Ab': ['Ab', 'Bbb', 'Bb', 'Cb', 'C', 'Db', 'D', 'Eb', 'Fb', 'F', 'Gb', 'G'],
            'Db': ['Db', 'Ebb', 'Eb', 'Fb', 'F', 'Gb', 'G', 'Ab', 'Bbb', 'Bb', 'Cb', 'C'],
            'Gb': ['Gb', 'Abb', 'Ab', 'Bbb', 'Bb', 'Cb', 'C', 'Db', 'Ebb', 'Eb', 'Fb', 'F'],
            
            // Do
            'C':  ['C', 'Db', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'Ab', 'A', 'Bb', 'B']
        };

        const DEGREES = ['1', 'b2', '2', 'b3', '3', '4', '#4', '5', 'b6', '6', 'b7', '7'];
        
        const PROG_MAJOR = [
            { label: "I - vi - ii - V", steps: [[0,'Maj7'], [9,'min7'], [2,'min7'], [7,'Dom7']] },
            { label: "I - IV - V - I", steps: [[0,'Maj'], [5,'Maj'], [7,'Maj'], [0,'Maj']] },
            { label: "ii - V - I - vi", steps: [[2,'min7'], [7,'Dom7'], [0,'Maj7'], [9,'min7']] },
            { label: "I - V/ii - ii - V", steps: [[0,'Maj7'], [9,'Dom7'], [2,'min7'], [7,'Dom7']] }
        ];

        const RESOLUTIONS = {
            0: [7, 0], 1: [0], 2: [0], 3: [2, 0], 4: [2, 0], 
            5: [4, 2, 0], 6: [7, 4, 0], 7: [4, 0], 8: [7, 12], 
            9: [7, 12], 10: [12], 11: [12], 12: [7, 12]
        };

        let audioCtx;
        let state = {
            mode: 'melody',
            keyIndex: 0, keyLabel: 'C', keyType: 'major',
            target: null, isPlaying: false, score: 0,
            imagina: false
        };

        function initAudio() {
            if(!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const comp = audioCtx.createDynamicsCompressor();
                comp.connect(audioCtx.destination);
                state.out = comp;
            }
        }

        function playTone(freq, dur, type='triangle', start=0, vol=0.25) {
            const t = start + audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq;
            g.gain.setValueAtTime(0, t);
            g.gain.linearRampToValueAtTime(vol, t+0.02);
            g.gain.exponentialRampToValueAtTime(0.001, t+dur);
            osc.connect(g); g.connect(state.out);
            osc.start(t); osc.stop(t+dur);
        }

        function playChord(rootFreq, type, dur, start, vol=0.15) {
            let intervals = [0, 4, 7]; 
            if(type === 'min7') intervals = [0, 3, 7, 10];
            if(type === 'Dom7') intervals = [0, 4, 7, 10];
            if(type === 'Maj7') intervals = [0, 4, 7, 11];
            if(type === 'Maj') intervals = [0, 4, 7];
            if(type === 'Min') intervals = [0, 3, 7];
            
            intervals.forEach(i => {
                playTone(rootFreq * Math.pow(2, i/12), dur, 'sine', start, vol);
                playTone(rootFreq * Math.pow(2, i/12), dur, 'triangle', start, vol*0.2);
            });
        }

        function getFreq(n, oct=4) { return 261.63 * Math.pow(2, (n + (oct-4)*12)/12); }

        function getNoteName(absNoteIndex) {
            const rel = (absNoteIndex - state.keyIndex + 12) % 12;
            const spelling = KEY_SPELLINGS[state.keyLabel] || KEY_SPELLINGS['C'];
            return spelling[rel];
        }

        // --- GAME LOGIC ---

        function setMode(m) {
            state.mode = m;
            document.getElementById('mode-melody').className = m === 'melody' ? "px-3 py-1.5 rounded text-[10px] uppercase font-bold transition-all bg-indigo-600 text-white shadow" : "px-3 py-1.5 rounded text-[10px] uppercase font-bold transition-all text-slate-400 hover:text-white";
            document.getElementById('mode-harmony').className = m === 'harmony' ? "px-3 py-1.5 rounded text-[10px] uppercase font-bold transition-all bg-indigo-600 text-white shadow" : "px-3 py-1.5 rounded text-[10px] uppercase font-bold transition-all text-slate-400 hover:text-white";
            
            document.getElementById('piano-stage').classList.toggle('hidden', m !== 'melody');
            document.getElementById('harmony-grid').classList.toggle('hidden', m !== 'harmony');
            resetUI();
        }

        function startGame() {
            if(state.isPlaying) return;
            initAudio();
            
            const keys = Object.keys(KEY_SPELLINGS);
            state.keyLabel = keys[Math.floor(Math.random()*keys.length)];
            const keyMap = {'C':0,'C#':1,'Db':1,'D':2,'Eb':3,'E':4,'F':5,'F#':6,'Gb':6,'G':7,'Ab':8,'A':9,'Bb':10,'B':11};
            state.keyIndex = keyMap[state.keyLabel];
            
            document.getElementById('key-root').innerText = state.keyLabel;
            document.getElementById('key-badge').classList.remove('hidden');
            document.getElementById('feedback-ui').classList.add('hidden');
            document.getElementById('btn-repeat').classList.add('hidden');
            
            if(state.mode === 'melody') renderPiano();
            else renderHarmonyOptions();

            playCadence(() => generateQuestion());
        }

        function playCadence(cb) {
            state.isPlaying = true;
            const r = getFreq(state.keyIndex, 3);
            let t = 0;
            const isJazz = Math.random() > 0.5;

            if(isJazz) {
                playChord(r * Math.pow(2, 2/12), 'min7', 0.8, t); t+=0.8;
                playChord(r * Math.pow(2, 7/12), 'Dom7', 0.8, t); t+=0.8;
                playChord(r, 'Maj7', 1.5, t); t+=1.5;
            } else {
                playChord(r, 'Maj', 0.6, t); t+=0.6;
                playChord(r * Math.pow(2, 5/12), 'Maj', 0.6, t); t+=0.6;
                playChord(r * Math.pow(2, 7/12), 'Dom7', 0.6, t); t+=0.6;
                playChord(r, 'Maj', 1.5, t); t+=1.5;
            }

            setTimeout(() => { state.isPlaying = false; if(cb) cb(); }, t*1000);
        }

        function generateQuestion() {
            if(state.mode === 'melody') {
                const interval = Math.floor(Math.random()*13);
                const abs = (state.keyIndex + interval) % 12;
                const oct = interval >= 12 ? 5 : 4;
                state.target = { type: 'melody', interval, abs, freq: getFreq(abs, oct), oct };
                playTone(state.target.freq, 1.5, 'triangle', 0, 0.4);
            } else {
                const prog = PROG_MAJOR[Math.floor(Math.random()*PROG_MAJOR.length)];
                state.target = { type: 'harmony', answer: prog.label, prog };
                playProgression(prog);
            }
            document.getElementById('btn-repeat').classList.remove('hidden');
            if(state.imagina) document.getElementById('imagina-overlay').classList.remove('hidden');
        }

        function playProgression(prog) {
            const rootFreq = getFreq(state.keyIndex, 3);
            let t = 0;
            prog.steps.forEach(step => {
                const chordRoot = rootFreq * Math.pow(2, step[0]/12);
                playChord(chordRoot, step[1], 1.0, t);
                t += 1.0;
            });
        }

        function checkAnswer(val) {
            if(!state.target || state.isPlaying) return;
            
            const isCorrect = state.mode === 'melody' ? (val === state.target.interval) : (val === state.target.answer);
            
            if(state.mode === 'melody') {
                const keyBtn = document.querySelector(`[data-interval="${val}"]`);
                keyBtn?.classList.add(isCorrect ? 'correct' : 'wrong');
                if(!isCorrect) document.querySelector(`[data-interval="${state.target.interval}"]`)?.classList.add('correct');
                
                // Resolución automática
                const targetData = state.target;
                setTimeout(() => {
                    const resPath = RESOLUTIONS[targetData.interval] || [];
                    let t = 0;
                    playTone(targetData.freq, 0.5, 'triangle', t, 0.3); t+=0.5;
                    resPath.forEach((step, idx) => {
                        const resAbs = (state.keyIndex + step) % 12;
                        const resOct = step >= 12 ? 5 : 4;
                        const dur = (idx === resPath.length -1) ? 1.2 : 0.5;
                        playTone(getFreq(resAbs, resOct), dur, 'sine', t, 0.3);
                        t += dur * 0.8;
                    });
                }, 600);
            } else {
                renderHarmonyOptions(val, state.target.answer);
            }

            showFeedbackUI(isCorrect);
            if(isCorrect) {
                state.score++;
                document.getElementById('score-val').innerText = state.score;
            }

            state.target = null;
        }

        function renderPiano() {
            const stage = document.getElementById('piano-stage');
            stage.innerHTML = '';
            
            // Geometría real del piano basada en Do=0
            const physicalOffsets = [0, 0.6, 1, 1.6, 2, 3, 3.6, 4, 4.6, 5, 5.6, 6];
            const startGlobalPos = (Math.floor(state.keyIndex/12)*7) + physicalOffsets[state.keyIndex%12];

            let whiteCount = 0;
            for(let i=0; i<25; i++) {
                const absNote = (state.keyIndex + i) % 12;
                const label = getNoteName(state.keyIndex + i);
                const isBlack = [1, 3, 6, 8, 10].includes(absNote);
                
                const currentGlobalPos = (Math.floor((state.keyIndex+i)/12)*7) + physicalOffsets[absNote];
                const relativePos = currentGlobalPos - startGlobalPos;
                
                const btn = document.createElement('button');
                btn.className = `piano-key ${isBlack ? 'key-black' : 'key-white'} active-degree`;
                btn.style.left = `${relativePos * 60}px`;
                btn.setAttribute('data-interval', i);
                
                const degIdx = i % 12;
                const displayDeg = (i === 12 || i === 24) ? '8' : DEGREES[degIdx];
                
                btn.innerHTML = `
                    <div class="labels-wrapper">
                        <div class="degree-tag">${displayDeg}</div>
                        <div class="note-name">${label}</div>
                    </div>
                `;

                if(i === 0 || i === 12 || i === 24) {
                    const marker = document.createElement('div');
                    marker.className = 'tonic-marker';
                    btn.appendChild(marker);
                }
                
                btn.onclick = () => {
                    const oct = 4 + Math.floor((state.keyIndex+i)/12) - 4;
                    playTone(getFreq(absNote, 4 + Math.floor((state.keyIndex+i)/12) - 4), 0.5);
                    checkAnswer(i);
                };
                
                stage.appendChild(btn);
                if(!isBlack) whiteCount++;
            }
            stage.style.width = `${whiteCount * 60}px`;
        }

        function renderHarmonyOptions(clicked = null, correct = null) {
            const grid = document.getElementById('harmony-grid');
            grid.innerHTML = '';
            PROG_MAJOR.forEach(p => {
                const btn = document.createElement('button');
                btn.className = "p-8 rounded-2xl border-2 border-slate-700 bg-slate-800 font-bold text-xl hover:border-indigo-500 transition-all active:scale-95";
                btn.innerText = p.label;
                
                if(clicked) {
                    if(p.label === correct) btn.className = "p-8 rounded-2xl border-2 border-emerald-500 bg-emerald-600/20 text-emerald-400 font-black scale-105";
                    else if(p.label === clicked) btn.className = "p-8 rounded-2xl border-2 border-rose-500 bg-rose-600/20 text-rose-400 opacity-50";
                    else btn.style.opacity = "0.2";
                } else {
                    btn.onclick = () => checkAnswer(p.label);
                }
                grid.appendChild(btn);
            });
        }

        function showFeedbackUI(isCorrect) {
            const ui = document.getElementById('feedback-ui');
            const icon = document.getElementById('feedback-icon');
            const text = document.getElementById('feedback-text');
            ui.classList.remove('hidden');
            ui.className = "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 text-center animate-bounce-in";
            icon.innerText = isCorrect ? "✨" : "⚠️";
            text.innerText = isCorrect ? "¡Correcto!" : "Incorrecto";
            text.className = `text-4xl font-black italic tracking-tighter ${isCorrect ? 'text-emerald-400' : 'text-rose-500'}`;
        }

        function resetUI() {
            document.getElementById('feedback-ui').classList.add('hidden');
            if(state.mode === 'melody') renderPiano();
            else renderHarmonyOptions();
        }

        function toggleImagina() {
            state.imagina = !state.imagina;
            document.getElementById('imagina-dot').className = `w-2 h-2 rounded-full ${state.imagina ? 'bg-indigo-400 shadow-[0_0_8px_rgba(99,102,241,0.8)]' : 'bg-slate-700'}`;
        }
        
        function revealPiano() { document.getElementById('imagina-overlay').classList.add('hidden'); }

        document.getElementById('btn-init').onclick = startGame;
        document.getElementById('btn-repeat').onclick = () => {
            if(state.target) {
                if(state.target.type === 'melody') playTone(state.target.freq, 1.5, 'triangle', 0, 0.4);
                else playProgression(state.target.prog);
            }
        };

        // Init
        renderPiano();
    </script>
</body>
</html>
